<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Docker-Basic</title>
</head>
<body>
  <pre style="font-size: 17px;">
---------------------------------<h1>Gi·ªõi thi·ªáu</h1>-------------------------------------
-Docker l√† m·ªôt d·ª± √°n m√£ ngu·ªìn m·ªü gi√∫p t·ª± ƒë·ªông tri·ªÉn khai c√°c ·ª©ng d·ª•ng Linux v√† Windows v√†o trong c√°c container ·∫£o h√≥a.
-Image : l√† c√°c b·ªô c√†i nh∆∞ Centos,MySQL,ubutu...
-Docker Hub : Noi qu·∫£n l√Ω c√°c image gi·ªëng nh∆∞ Github
-Container:L√† m√°y ·∫£o t·∫°o ra t·ª´ Image
-Dockerfile:l√† m·ªôt t·∫≠p tin bao g·ªìm c√°c ch·ªâ d·∫´n ƒë·ªÉ build m·ªôt image
-volume : L∆∞u data ra ngo√†i container
-Docker-compose : Edit dockerfile, d√πng ƒë·ªÉ ch·∫°y multi container ƒë·ªìng th·ªùi 
-----------------------------------------------------

-Docker networks : Docker container c√≥ IP , Docker network ƒë·ªÉ k·∫øt n·ªëi c√°c container trong c√πng m·∫°ng ho·∫∑c kh√°c m·∫°ng v·ªõi nhau

----------------------------------------------------------------------
üèÉüèº‚Äç‚ôÄÔ∏è Lab document
C√°c l·ªánh v·ªõi image
- T√¨m image ƒë·ªÉ c√†i ƒë·∫∑t
docker search centos
- List c√°c image ƒëang c√≥
docker image ls
- X√≥a image
sudo docker rmi [Image ID]
Ch√∫ √Ω: C√°c image m√† c√≥ container ƒëang ch·∫°y th√¨ s·∫Ω kh√¥ng x√≥a ƒë∆∞·ª£c m√† ph·∫£i x√≥a container li√™n quan t·ªõi n√≥ tr∆∞·ªõc
- Pull image v·ªÅ
docker pull centos:7

L√†m vi·ªác v·ªõi container

- Ch·∫°y 1 container t·ª´ image
 docker run --privileged -d -p 80:80 hello-world /sbin/init
 docker run --privileged -d -p 172.0.0.1:80 centos:7 /sbin/init
 docker run --privileged -d -p 127.0.0.1:8080:80 tungns2101/project01:v1 /sbin/init

- V√†o container ƒë·ªÉ ch·∫°y l·ªánh
docker exec -it [Container ID] /bin/bash 

- C√†i ƒë·∫∑t apache
yum -y install httpd
systemctl start httpd
systemctl enable httpd

echo "Hello Tin Hoc That La Don Gian" > /var/www/html/index.html

- Tho√°t ra kh·ªèi container
exit

- T·∫°o image ƒë·ªÉ tri·ªÉn khai cho m√°y kh√°c
docker commit -m "Comment" -a "T√°c gi·∫£"  [Container ID] [Image Name]
docker commit -m "Centos Project01" -a "Nguyen Son Tung" 17d5e6b7a986 tungns/project01:v1

- ƒêƒÉng nh·∫≠p v√†o docker/hub
docker login

- ƒê∆∞a image l√™n docker hup ƒë·ªÉ m·ªçi ng∆∞·ªùi c√πng s·ª≠ d·ª•ng
docker push [T√™n image]
docker push tungns2101/project01:v1
 
- Check c√°c container ƒëang ch·∫°y
sudo docker ps -a

- Xem tr·∫°ng th√°i container
docker container ls -a

- X√≥a containner
sudo docker rm [Container ID]

- Stop container
docker container stop [Container ID]

- Restart container
docker container restart [Container ID]

- Pause container
docker container pause  [Container ID]

- Truy c·∫≠p v√†o c√°c container ƒëang ch·∫°y
docker container attach [Container ID]


- L·ªánh stop to√†n b·ªô container
docker stop $(docker ps -a -q)

- L·ªánh x√≥a to√†n b·ªô container
docker rm $(docker ps -a -q)

- L·ªánh x√≥a to√†n b·ªô image
docker rmi -f $(docker images -a -q)
--------------------------------------<h1>Dockerfile</h1>---------------------------------
FROM:  l·∫•y 1 image tr√™n docker hub
LABEL: Th√¥ng tin ng∆∞·ªùi b·∫£o tr√¨ dockerfile
ENV : Thi·∫øt l·∫≠p m·ªôt bi·∫øn m√¥i tr∆∞∆°ng
RUN : Ch·ªâ ch·∫°y khi build Image, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ c√†i ƒë·∫∑t c√°c package v√†o trong container
COPY : sao ch√©p c√°c file v√† th∆∞ m·ª•c v√†o trong container 
ADD : sao ch√©p c√°c file v√† th∆∞ m·ª•c v√†o trong container 
CMD : trong 1 Dockerfile ch·ªâ c√≥ 1 CMD , ch·ªâ ch·∫°y khi th·ª•c hi·ªán run ƒë·ªÉ t·∫°o ra 1 container
WORKDIR : Thi·∫øt l·∫≠p th∆∞ m·ª•c l√†mvi·ªáccho c√°c ch·ªâ th·ªã kh√°c nh∆∞ :RUN , CMD, ENTRYPOINT, COPY, ADD, ...
ARG : ƒê·ªãnh nghƒ©a c√°c gi√° tr·ªã bi·∫øn ƒë∆∞·ª£c d√πng trong l√∫cbuild image
ENTRYPOINT : cung c·∫•p c√°c l·ªánh v√† ƒë√¥i s·ªë cho m·ªôt container th·ª±c thi
EXPOSE : Khai b√°o port l·∫Øng nghe c·ªßa image 
VOLUME : t·∫°o m·ªôt ƒëi·ªÉm ng·∫Øn nh∆∞ th∆∞ m·ª•c ƒë·ªÉ truy c·∫≠p v√† l∆∞u tr·ªØ data
++++++++++++++++++++++
üèÉüèº‚Äç‚ôÄÔ∏è Lab document
1. T·∫°o Dockerfile

# Get base image
FROM centos:7

# Author
MAINTAINER "Nguyen Quoc Bao"

#Cai dat apache
RUN yum update -y
RUN yum install -y sudo
RUN yum install -y epel-release
RUN yum install -y http://rpms.famillecollet.com/enterpr...
RUN yum clean all
RUN yum -y install wget
RUN yum -y install httpd
RUN yum -y install --enablerepo=remi,remi-php71 php php-devel php-mbstring php-pdo php-gd php-xml php-mcrypt php-pgsql
 
#Thiet lap thu muc lam viec 
WORKDIR /var/www/html

#copy code tu thu muc code vao image
ADD ./code /var/www/html

# start httpd
CMD ["/usr/sbin/httpd", "-D", "FOREGROUND"]

EXPOSE 80


2. Build image
docker build -t httpd_sample . (httpd_sample l√† t√™n image c√≤n '.'  l√† call ƒë·∫øn file dockerfile hi·ªán t·∫°i)

3. T·∫°o v√† ch·∫°y container
docker run -d -p 80:80 httpd_sample
---------------------------------<h1>Docker Compose</h1> --------------------------
version : Ch·ªâ ra phi√™n b·∫£n docker-compose ƒë√£ s·ª≠ d·ª•ng 
services : thi·∫øt l·∫≠p c√°c services(containers) mu·ªën c√†i ƒë·∫∑t v√† ch·∫°y 
iamge : ch·ªâ ra images ƒë∆∞·ª£c s·ª≠ d·ª•ng trong l√∫c t·∫°o ra container
build : d√πng ƒë·ªÉ t·∫°o container (map t·ªõi dockerfile)
ports : thi·∫øt l·∫≠p posts ch·∫°y t·∫°i m√°y host v√† trong container
restart: t·ª± kh·ªüi ƒë·ªông ch·∫°y khi container b·ªã t·∫Øt
environment : thi·∫øt l·∫≠p bi·∫øn m√¥i tr∆∞·ªùng (th∆∞·ªùng s·ª≠ d·ª•ng trong l√∫c config c√°c th√¥ng s·ªë c·ªßa db)
depends_on : ch·ªâ ra s·ª± ph·ª• thu·ªôc . t·ª©c l√† container n√†o ph·∫£i ƒë∆∞·ª£c c√†i ƒë·∫∑t v√† ch·∫°y tr∆∞·ªõc th√¨ container ƒë∆∞·ª£c config t·∫°i ƒë√≥ m·ªõi ƒë∆∞·ª£c ch·∫°y
volumes: D√πng ƒë·ªÉ mount  hai th∆∞ m·ª•c host v√† container v·ªõi nhau 
links : Cho ph√©p ƒëƒÉng k√≠ m·ªôt c√°i t√™n b√≠ danh ƒë·ªÉ cho c√°c server kh√°c c√≥ th·ªÉ g·ªçi .ƒêi·ªÅu ƒë·∫∑c bi·ªát l√† c√≥ th·ªÉ ƒëem l·∫°i m·ªôt c√°i t√™n "h·ª£p v·ªá  sinh" ch√∫ng ta kh√¥ng c·∫ßn ph·∫£i nh·ªõ truy c·∫≠p tr√™n c·ªïng n√†o nh∆∞ tr√™n host 
Ch·ªâ c·∫ßn s·ª≠ d·ª•ng t√™n l√† c√≥ th·ªÉ k·∫øt  n·ªëi v·ªõi service mong mu·ªën.
Context : x√°c ƒë·ªãnh th∆∞ m·ª•c ch·ª©c g·ªëc . D·ª±a v√†o th∆∞ m·ª•c n√†y ch√∫ng ta kh√°i b√°o ti·∫øp ƒë∆∞·ªùng d·∫´n dockerfile
----------------------------------------------
1. C√†i EC2
#!/bin/bash
yum update -y
yum install -y docker
service docker start
chkconfig docker on
curl -L "https://github.com/docker/compose/releases/download/1.11.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose


Sample

1. T·∫°o file Dockerfile

FROM centos:7
RUN yum -y update && \
    yum -y install httpd php
WORKDIR /var/www/html
ADD ./code /var/www/html
EXPOSE 80

2.T·∫°o file docker-compose.yml
version: '3'
services:                                                                                       
  web:                                                                                          
    build: .
	command: ["/usr/sbin/httpd","-D","FOREGROUND"]           
    ports:                                                                                      
      - "80:80"
	  
	  
- Build image
$ docker-compose build

- Ch·∫°y container
$ docker-compose up -d

- Stop
$ docker-compose stop

- Start l·∫°i container
$ docker-compose start

- Stop v√† x√≥a container
$ docker-compose down

https://github.com/dockersamples/example-voting-app
------------------------------------------------<h1>Docker volume - Docker networks</h1>----------------------------------------
https://xuanthulab.net/chia-se-du-lieu-giua-docker-host-va-container.html
1. Volume
- Docker volume : l√†  m·ªôt n∆°i l∆∞u tr·ªØ data n·∫±m ngo√†i container , m·ª•c ƒë√≠ch kh√¥ng l√†m m·∫•t data khi x√≥a container 
- S·ª≠ d·ª•ng volume khi n√†o :
	+ Khi chia s·∫ª d·ªØ li·ªáu gi·ªØa nhi·ªÅu container ƒëang ch·∫°y
	+ L∆∞u d·ªØ li·ªáu t·ªõi m·ªôt server remote ho·∫∑c cloud .
	+ Khi c·∫ßn backup, restore ho·∫∑c migrate d·ªØ li·ªáu docker Host n√†y sang Docker Host kh√°c 
-----------------------------------------------------------------------------
- li√™n k·∫øt gi·ªØa m√°y ch·ªß  host v√† container (-v)
	+docker run -it -v pathHost:pathContainer imageID
		eg:docker run -it -v C:\Users\Admin\Desktop\Docker:/home/data 0d120b6ccaa8

- volume vs container (tham s·ªë -mount)
	+ docker volume create firstdisk
	+ docker run -it --mount source=firstdisk,target=/home/firstdisk  ubuntu
		eg:docker run -it --mount source=mydata,target=/home/mydata ubuntu


- Chia s·∫ª d·ªØ li·ªáu gi·ªØa c√°c container : (--volumes-from)
	+ docker run -it --volumes-from container_first ubuntu


- Volume √°nh x·∫° ƒë·∫øn th∆∞ m·ª•c tr√™n m√°y host:
	+ docker volume create --opt device=path_in_host --opt type=none --opt o=bind  volumename
		eg:	#T·∫°o ·ªï ƒëƒ©a c√≥ t√™n mydisk (d·ªØ li·ªáu l∆∞u t·∫°i /home/mydata)
			   docker volume create --opt device=/home/mydata --opt type=none --opt o=bind  mydisk

			# G√°n ·ªï ƒëƒ©a v√†o container t·∫°i (/home/sites) do lo·∫°i n√†y kh√¥ng d√πng tham s·ªë --mount ƒë∆∞·ª£c n√™n ta d√πng -v 
			   docker run -it -v mydisk:/home/sites ubuntu


- docker volume prune: X√≥a t·∫•t c·∫£ c√°c ·ªï ƒëƒ©a kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi container n√†o
container run --name mysql -v mysql_volume:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=pass -p 3307:3306 -d mysql:5.7

------------------------------------------------------------------------------
- C√°c l·ªánh li√™n quan :
# docker volume create       T·∫°o m·∫°ng m·ªõi
# docker volume inspect      Xem chi ti·∫øt m·∫°ng
# docker volume ls           Hi·ªÉn th·ªã nh·ªØng m·∫°ng ƒëang c√≥
# docker volume rm           X√≥a volume
# docker volume prune        X√≥a to√†n b·ªô volumn

V√≠ d·ª•
docker volume create project01_code
docker run --name project01 -p 8081:80 -v project01_code:/usr/local/apache2/htdocs -d httpd

V√≠ d·ª• 2
docker container run --name mysql -e MYSQL_ROOT_PASSWORD=pass -p 3306:3306 -d mysql:5.7

docker volume create pj01_data
docker container run --name mysql -v pj01_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=pass -p 3306:3306 -d mysql:5.7


2. Networks

V√≠ d·ª• 1
T·∫°o 1 m·∫°ng l·ªõp C
docker network create --subnet 192.168.1.0/24 network1

T·∫°o ra 2 container k·∫øt n·ªëi v·ªõi m·∫°ng n√†y
docker run -itd --name=container1  --network network1 busybox
docker run -itd --name=container2  --network network1 busybox

Ki·ªÉm tra k·∫øt n·ªëi gi·ªØa 2 m·∫°ng
docker attach container1

V√≠ d·ª• 2
# docker run --name mysql --network network1 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:5.7
# docker run --name wordpress --network network1 -e WORDPRESS_DB_PASSWORD=my-secret-pw -p 8080:80 -d wordpress




Sampe 1 t·∫°o DB MYSQL
sample-project/
             ‚îú docker/
             |       ‚îî mysql/
             |              ‚îú conf.d/
             |              |       ‚îî my.cnf
             |              ‚îú initdb.d/
             |              |         ‚îú schema.sql
             |              |         ‚îî testdata.sql
             |              ‚îî Dockerfile
			 ‚îú log/mysql
			 |
			 |
			 |
             ‚îî docker-compose.yml
			 
			 
mkdir pj03
cd pj03
mkdir -p docker/mysql/conf.d
mkdir -p docker/mysql/initdb.d
mkdir -p docker/mysql/conf.d
mkdir -p log/mysql
chmod -Rf 777 log

vi docker/mysql/conf.d/my.cnf
[mysqld]
character-set-server=utf8mb4
explicit-defaults-for-timestamp=1
general-log=1
general-log-file=/var/log/mysql/mysqld.log

[client]
default-character-set=utf8mb4



vi docker/mysql/initdb.d/schema.sql
CREATE TABLE users (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(32) NOT NULL,
    email VARCHAR(32) NOT NULL,
    PRIMARY KEY (id)
);

vi docker/mysql/initdb.d/testdata.sql
INSERT INTO users (id,name,email) VALUES (1, 'Tuc Anh Ach','achsan@tinhocthatladongian.com');



vi docker/mysql/Dockerfile
FROM mysql:5.7
RUN touch /var/log/mysql/mysqld.log


vi docker-compose.yml
version: '3'
services:
  db:
    build: ./docker/mysql
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_DATABASE: sample_db
      MYSQL_USER: user
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: rootpassword
    ports:
      - "3314:3306"
    volumes:
      - ./docker/mysql/initdb.d:/docker-entrypoint-initdb.d
      - ./docker/mysql/conf.d:/etc/mysql/conf.d
      - ./log/mysql:/var/log/mysql
      - mysql_data:/var/lib/mysql
volumes:
  mysql_data:

	  
- Build container
docker-compose up -d 

- Truy c·∫≠p v√†o container ƒë·ªÉ ch·∫°y l·ªánh
docker exec -it sampleproject_db_1 bash

$ mysql -u user -p

INSERT INTO users (id,name,email) VALUES (2, 'BAo','bao@mail.co.jp');



truy c·∫≠p v√†o t·ª´ ngo√†i b·∫±ng Navicat
mysql --host 127.0.0.1 --port 3314 -u user -p 





Sample 2
mkdir { my-wordpress-dir-name }
cd { my-wordpress-dir-name } 


docker-compose.yml

version: "2"
services:
  wordpress:
    image: wordpress:latest
    container_name: pj10_wordpress
    volumes:
      - ".:/var/www/html"
      - "./.docker/backup:/tmp/backup"
      - "./.docker/log:/tmp/log"
    ports:
      - 8080:80
    depends_on:
      - db
    environment:
      WORDPRESS_DB_HOST: "db:3306"
    networks:
      - pj10_network
    env_file: .env

  db:
    image: mysql:5.7
    container_name: pj10_mysql
    volumes:
      - "db-data:/var/lib/mysql"
    networks:
      - pj10_network
    env_file: .env

volumes:
  db-data:

networks:
  pj10_network:
  
  
  
File .env
WORDPRESS_DB_NAME=wordpress
WORDPRESS_DB_USER=admin
WORDPRESS_DB_PASSWORD=pass

MYSQL_RANDOM_ROOT_PASSWORD=yes
MYSQL_DATABASE=wordpress
MYSQL_USER=admin
MYSQL_PASSWORD=pass

------------------------------------------------<h1>AWS/ECS</h1>----------------------------------------

Th·ª±c h√†nh AWS/ECS

1. C√†i EC2
#!/bin/bash
yum update -y
yum install -y docker
service docker start
chkconfig docker on
curl -L "https://github.com/docker/compose/releases/download/1.11.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose


$ mkdir nginx
$ cd nginx
$ vi Dockerfile
FROM nginx
COPY html /usr/share/nginx/html


$ mkdir html
$ vi html/index.html
#{html}
#{head}<title>Tin hoc that la don gian{/title}{/head}
#{body}<h1>Xin chao tin hoc that la don gian{/h1}{/body}
#{/html}


$docker build -t [Image Name]:tag .
	->docker build -t tinhocthatladongian:v1 .

- AWS ECR Login
aws ecr get-login --no-include-email --region eu-west-2


- T·∫°o repository l√™n AWS/ECR(Amazon Elastic Container Registry)
aws ecr create-repository --repository-name [Repository Name] --region eu-west-2
->aws ecr create-repository --repository-name tinhocthatladongian --region eu-west-2


- T·∫°o tag version docker image
docker tag [Image Name]:tag [Repository ULR] ƒë√£ t·∫°o ra ·ªü b∆∞·ªõc tr√™n]
->docker tag tinhocthatladongian:v1 251123607109.dkr.ecr.eu-west-2.amazonaws.com/tinhocthatladongian

- Push l√™n AWS/ECR
docker push [Repository ULR]
->docker push 251123607109.dkr.ecr.eu-west-2.amazonaws.com/tinhocthatladongian

- T·∫°o Task tr√™n AWC/ECS
- T·∫°o Clusters tr√™n AWC/ECS

C√°c l·ªánh x√≥a ƒë·ªìng lo·∫°t
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
docker rmi -f $(docker images -a -q)
  </pre>
</body>
</html>
